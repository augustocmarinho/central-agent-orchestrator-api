{
  "info": {
    "name": "AI Agents Backend",
    "description": "Collection completa para a API do sistema de Agentes de IA",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_exporter_id": "ai-agents-backend"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3000",
      "type": "string"
    },
    {
      "key": "token",
      "value": "",
      "type": "string"
    },
    {
      "key": "agentId",
      "value": "",
      "type": "string"
    },
    {
      "key": "conversationId",
      "value": "",
      "type": "string"
    },
    {
      "key": "pluginId",
      "value": "",
      "type": "string"
    },
    {
      "key": "systemToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "systemTokenId",
      "value": "",
      "type": "string"
    },
    {
      "key": "messageId",
      "value": "",
      "type": "string"
    },
    {
      "key": "socketId",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Health Check",
      "item": [
        {
          "name": "Check API Health",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/health",
              "host": ["{{baseUrl}}"],
              "path": ["api", "health"]
            },
            "description": "Verifica se a API est√° funcionando corretamente"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Authentication",
      "item": [
        {
          "name": "Register User",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.user) {",
                  "        pm.environment.set('userId', response.data.user.id);",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Jo√£o Silva\",\n  \"email\": \"joao.silva@example.com\",\n  \"password\": \"senha123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "register"]
            },
            "description": "Registra um novo usu√°rio no sistema. A senha deve ter no m√≠nimo 6 caracteres, conter pelo menos uma letra e um n√∫mero."
          },
          "response": []
        },
        {
          "name": "Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.token) {",
                  "        pm.collectionVariables.set('token', response.data.token);",
                  "        console.log('Token salvo com sucesso!');",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@example.com\",\n  \"password\": \"admin123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "login"]
            },
            "description": "Realiza login e retorna um token JWT. Use as credenciais padr√£o:\n- Email: admin@example.com\n- Senha: admin123"
          },
          "response": []
        },
        {
          "name": "Get Current User",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/auth/me",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "me"]
            },
            "description": "Retorna as informa√ß√µes do usu√°rio autenticado"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Agents",
      "item": [
        {
          "name": "Create Agent - Simple Mode",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.agent) {",
                  "        pm.collectionVariables.set('agentId', response.data.agent.id);",
                  "        console.log('Agent ID salvo: ' + response.data.agent.id);",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Sofia - Assistente Virtual\",\n  \"creationMode\": \"simple\",\n  \"objective\": \"Ajudar clientes com d√∫vidas sobre produtos e servi√ßos\",\n  \"persona\": \"Assistente virtual amig√°vel e prestativa\",\n  \"audience\": \"Clientes da loja online\",\n  \"topics\": \"Produtos, servi√ßos, pedidos, entregas, pagamentos\",\n  \"restrictions\": \"N√£o fornecer informa√ß√µes sobre pre√ßos sem verificar o cat√°logo\",\n  \"knowledgeSource\": \"Base de conhecimento da empresa\",\n  \"useAI\": false\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/agents",
              "host": ["{{baseUrl}}"],
              "path": ["api", "agents"]
            },
            "description": "Cria um agente no modo simplificado. O sistema gerar√° automaticamente o prompt final baseado nos campos estruturados."
          },
          "response": []
        },
        {
          "name": "Create Agent - Advanced Mode",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.agent) {",
                  "        pm.collectionVariables.set('agentId', response.data.agent.id);",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Carlos - Especialista T√©cnico\",\n  \"creationMode\": \"advanced\",\n  \"finalPrompt\": \"Voc√™ √© Carlos, um especialista t√©cnico altamente qualificado. Sua fun√ß√£o √© fornecer suporte t√©cnico detalhado para desenvolvedores. Voc√™ deve:\\n\\n1. Analisar problemas t√©cnicos com precis√£o\\n2. Fornecer solu√ß√µes baseadas em melhores pr√°ticas\\n3. Explicar conceitos complexos de forma clara\\n4. Sempre validar suas respostas\\n\\nTom: Profissional, t√©cnico mas acess√≠vel\\nLimites: N√£o fornecer informa√ß√µes sobre infraestrutura interna da empresa\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/agents",
              "host": ["{{baseUrl}}"],
              "path": ["api", "agents"]
            },
            "description": "Cria um agente no modo avan√ßado, onde voc√™ define diretamente o prompt final."
          },
          "response": []
        },
        {
          "name": "List Agents",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/agents",
              "host": ["{{baseUrl}}"],
              "path": ["api", "agents"]
            },
            "description": "Lista todos os agentes do usu√°rio autenticado"
          },
          "response": []
        },
        {
          "name": "Get Agent by ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/agents/{{agentId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "agents", "{{agentId}}"]
            },
            "description": "Busca um agente espec√≠fico pelo ID"
          },
          "response": []
        },
        {
          "name": "Update Agent",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Sofia - Assistente Virtual Atualizada\",\n  \"status\": \"active\",\n  \"objective\": \"Ajudar clientes com d√∫vidas sobre produtos, servi√ßos e suporte t√©cnico\",\n  \"persona\": \"Assistente virtual muito amig√°vel e extremamente prestativa\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/agents/{{agentId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "agents", "{{agentId}}"]
            },
            "description": "Atualiza um agente existente. Todos os campos s√£o opcionais. Status pode ser: active, paused, draft"
          },
          "response": []
        },
        {
          "name": "Delete Agent",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/agents/{{agentId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "agents", "{{agentId}}"]
            },
            "description": "Remove um agente do sistema"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Plugins",
      "item": [
        {
          "name": "List All Plugins",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/plugins",
              "host": ["{{baseUrl}}"],
              "path": ["api", "plugins"]
            },
            "description": "Lista todos os plugins dispon√≠veis no sistema (cat√°logo)"
          },
          "response": []
        },
        {
          "name": "Get Plugin by ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/plugins/{{pluginId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "plugins", "{{pluginId}}"]
            },
            "description": "Busca detalhes de um plugin espec√≠fico"
          },
          "response": []
        },
        {
          "name": "List Agent Plugins",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/agents/{{agentId}}/plugins",
              "host": ["{{baseUrl}}"],
              "path": ["api", "agents", "{{agentId}}", "plugins"]
            },
            "description": "Lista todos os plugins instalados em um agente espec√≠fico"
          },
          "response": []
        },
        {
          "name": "Install Plugin - Echo",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    console.log('Plugin instalado com sucesso!');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"pluginId\": \"echo\",\n  \"isSandbox\": false,\n  \"config\": {\n    \"prefix\": \"[Echo]\"\n  }\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/agents/{{agentId}}/plugins",
              "host": ["{{baseUrl}}"],
              "path": ["api", "agents", "{{agentId}}", "plugins"]
            },
            "description": "Instala o plugin Echo no agente. Este plugin simplesmente repete as mensagens recebidas."
          },
          "response": []
        },
        {
          "name": "Install Plugin - Calendar Fake",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"pluginId\": \"calendar_fake\",\n  \"isSandbox\": true,\n  \"config\": {\n    \"maxEvents\": 50,\n    \"defaultDuration\": 60\n  }\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/agents/{{agentId}}/plugins",
              "host": ["{{baseUrl}}"],
              "path": ["api", "agents", "{{agentId}}", "plugins"]
            },
            "description": "Instala o plugin Calendar Fake no agente. Este plugin simula um sistema de agendamento em mem√≥ria."
          },
          "response": []
        },
        {
          "name": "Uninstall Plugin",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/agents/{{agentId}}/plugins/{{pluginId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "agents", "{{agentId}}", "plugins", "{{pluginId}}"]
            },
            "description": "Remove um plugin de um agente"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Async Messaging (NEW)",
      "description": "Sistema de mensageria ass√≠ncrona com filas, Pub/Sub e WebSocket. Use estes endpoints para integra√ß√£o moderna e escal√°vel.",
      "item": [
        {
          "name": "Send Message (Async - New Conversation)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 202) {",
                  "    const response = pm.response.json();",
                  "    if (response.data) {",
                  "        pm.collectionVariables.set('conversationId', response.data.conversationId);",
                  "        pm.collectionVariables.set('messageId', response.data.messageId);",
                  "        console.log('‚úÖ Conversation ID: ' + response.data.conversationId);",
                  "        console.log('‚úÖ Message ID: ' + response.data.messageId);",
                  "        console.log('üìä Status: ' + response.data.status);",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"agentId\": \"{{agentId}}\",\n  \"message\": \"Ol√°! Preciso de ajuda com meu pedido.\",\n  \"channel\": \"web\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/messages",
              "host": ["{{baseUrl}}"],
              "path": ["api", "messages"]
            },
            "description": "**[RECOMENDADO]** Envia uma mensagem de forma ass√≠ncrona usando sistema de filas.\n\n**Retorna imediatamente (202 Accepted)** com:\n- `messageId`: ID da mensagem para rastreamento\n- `conversationId`: ID da conversa (novo ou existente)\n- `jobId`: ID do job na fila\n- `status`: Estado atual (processing)\n\n**Recebimento da resposta:**\n- Via WebSocket: Autom√°tico se conectado\n- Via Polling: Use GET /api/messages/:messageId/status\n- Via Callback: Configure channelMetadata.callbackUrl"
          },
          "response": []
        },
        {
          "name": "Send Message (Async - Existing Conversation)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 202) {",
                  "    const response = pm.response.json();",
                  "    if (response.data) {",
                  "        pm.collectionVariables.set('messageId', response.data.messageId);",
                  "        console.log('‚úÖ Message ID: ' + response.data.messageId);",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"agentId\": \"{{agentId}}\",\n  \"conversationId\": \"{{conversationId}}\",\n  \"message\": \"Qual o status do meu pedido #12345?\",\n  \"channel\": \"web\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/messages",
              "host": ["{{baseUrl}}"],
              "path": ["api", "messages"]
            },
            "description": "Continua uma conversa existente. A resposta ser√° entregue via WebSocket para TODOS os clientes conectados nessa conversa (broadcast por conversationId)."
          },
          "response": []
        },
        {
          "name": "Send Message with WebSocket ID",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 202) {",
                  "    const response = pm.response.json();",
                  "    console.log('‚úÖ Mensagem enfileirada! Use o socketId para receber via WebSocket espec√≠fico.');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"agentId\": \"{{agentId}}\",\n  \"conversationId\": \"{{conversationId}}\",\n  \"message\": \"Mensagem enviada via POST mas recebida via WebSocket\",\n  \"channel\": \"web\",\n  \"channelMetadata\": {\n    \"websocketId\": \"{{socketId}}\"\n  }\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/messages",
              "host": ["{{baseUrl}}"],
              "path": ["api", "messages"]
            },
            "description": "Envia mensagem via POST mas com socketId espec√≠fico. A resposta ser√° entregue diretamente para esse WebSocket.\n\n**Quando usar:**\n- Integra√ß√£o h√≠brida REST + WebSocket\n- Cliente tem m√∫ltiplas conex√µes\n- Quer garantir entrega em socket espec√≠fico\n\n**Como obter socketId:**\n1. Conecte WebSocket\n2. Receba evento: `{\"type\": \"connected\", \"data\": {\"socketId\": \"abc-123\"}}`\n3. Use esse socketId aqui"
          },
          "response": []
        },
        {
          "name": "Get Message Status",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/messages/{{messageId}}/status",
              "host": ["{{baseUrl}}"],
              "path": ["api", "messages", "{{messageId}}", "status"]
            },
            "description": "Verifica o status de processamento de uma mensagem.\n\n**Estados poss√≠veis:**\n- `waiting`: Na fila, aguardando processamento\n- `active`: Sendo processado agora\n- `completed`: Processado com sucesso\n- `failed`: Erro no processamento\n- `delayed`: Agendado para futuro\n- `stuck`: Worker travou (raro)\n\n**Informa√ß√µes retornadas:**\n- `state`: Estado atual\n- `progress`: Progresso (0-100)\n- `failedReason`: Motivo de falha (se aplic√°vel)\n- `processedOn`: Timestamp de in√≠cio\n- `finishedOn`: Timestamp de conclus√£o"
          },
          "response": []
        },
        {
          "name": "Get Queue Statistics",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/messages/queue/stats",
              "host": ["{{baseUrl}}"],
              "path": ["api", "messages", "queue", "stats"]
            },
            "description": "Retorna estat√≠sticas da fila de processamento.\n\n**M√©tricas inclu√≠das:**\n- `waiting`: Mensagens aguardando processamento\n- `active`: Mensagens sendo processadas agora\n- `completed`: Total de mensagens completadas\n- `failed`: Total de mensagens com falha\n- `delayed`: Mensagens agendadas\n- `paused`: Fila pausada (se aplic√°vel)\n\n**√ötil para:**\n- Monitoramento de performance\n- Detec√ß√£o de gargalos\n- Dashboards de status"
          },
          "response": []
        },
        {
          "name": "Queue Health Check",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/messages/queue/health",
              "host": ["{{baseUrl}}"],
              "path": ["api", "messages", "queue", "health"]
            },
            "description": "Verifica a sa√∫de do sistema de filas.\n\n**Retorna:**\n- `healthy`: true/false\n- `stats`: Estat√≠sticas atuais\n- `error`: Mensagem de erro (se n√£o saud√°vel)\n\n**Status HTTP:**\n- 200: Sistema saud√°vel\n- 503: Sistema com problemas\n\n**Use para:**\n- Health checks de load balancer\n- Monitoramento (Prometheus, Datadog)\n- Alertas autom√°ticos"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Chat (Legacy)",
      "description": "‚ö†Ô∏è LEGACY: Endpoints s√≠ncronos antigos. Use 'Async Messaging' para nova implementa√ß√£o.",
      "item": [
        {
          "name": "[LEGACY] Send Message Sync (New Conversation)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.conversationId) {",
                  "        pm.collectionVariables.set('conversationId', response.data.conversationId);",
                  "        console.log('Conversation ID salvo: ' + response.data.conversationId);",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"agentId\": \"{{agentId}}\",\n  \"content\": \"Ol√°! Preciso de ajuda com meu pedido.\",\n  \"channel\": \"web\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/chat/message",
              "host": ["{{baseUrl}}"],
              "path": ["api", "chat", "message"]
            },
            "description": "‚ö†Ô∏è **LEGACY - S√≠ncrono**\n\nEnvia uma mensagem de forma S√çNCRONA (espera resposta completa).\n\n**Problemas:**\n- Timeout se LLM demorar >30s\n- N√£o escal√°vel\n- Bloqueia conex√£o HTTP\n\n**Migre para:** POST /api/messages (ass√≠ncrono)"
          },
          "response": []
        },
        {
          "name": "[LEGACY] Send Message Sync (Existing Conversation)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"agentId\": \"{{agentId}}\",\n  \"conversationId\": \"{{conversationId}}\",\n  \"content\": \"Qual o status do meu pedido #12345?\",\n  \"channel\": \"web\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/chat/message",
              "host": ["{{baseUrl}}"],
              "path": ["api", "chat", "message"]
            },
            "description": "‚ö†Ô∏è **LEGACY - S√≠ncrono**\n\nContinua uma conversa de forma S√çNCRONA.\n\n**Migre para:** POST /api/messages (ass√≠ncrono)"
          },
          "response": []
        },
        {
          "name": "Get Conversation",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/chat/conversations/{{conversationId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "chat", "conversations", "{{conversationId}}"]
            },
            "description": "Busca o hist√≥rico completo de uma conversa com todas as mensagens do MongoDB."
          },
          "response": []
        },
        {
          "name": "List Agent Conversations",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/agents/{{agentId}}/conversations?limit=50",
              "host": ["{{baseUrl}}"],
              "path": ["api", "agents", "{{agentId}}", "conversations"],
              "query": [
                {
                  "key": "limit",
                  "value": "50",
                  "description": "N√∫mero m√°ximo de conversas a retornar (padr√£o: 50)"
                }
              ]
            },
            "description": "Lista todas as conversas de um agente espec√≠fico do MongoDB."
          },
          "response": []
        }
      ]
    },
    {
      "name": "System Tokens",
      "item": [
        {
          "name": "Create System Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.token) {",
                  "        pm.collectionVariables.set('systemToken', response.data.token.token);",
                  "        pm.collectionVariables.set('systemTokenId', response.data.token.id);",
                  "        console.log('System Token salvo: ' + response.data.token.token);",
                  "        console.log('System Token ID: ' + response.data.token.id);",
                  "        console.log('‚ö†Ô∏è IMPORTANTE: Guarde este token em local seguro!');",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"N8N Production\",\n  \"description\": \"Token de sistema para integra√ß√£o com N8N\",\n  \"allowed_ips\": [\"192.168.1.100\", \"10.0.0.0/8\"],\n  \"expires_at\": null\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/system-tokens",
              "host": ["{{baseUrl}}"],
              "path": ["api", "system-tokens"]
            },
            "description": "Cria um novo token de sistema para integra√ß√£o com N8N ou outros sistemas. Requer permiss√£o de ADMIN.\n\n**Campos:**\n- `name`: Nome identificador do token\n- `description`: Descri√ß√£o do uso\n- `allowed_ips`: Array de IPs permitidos (IP exato, CIDR ou wildcard). Deixe vazio para permitir todos os IPs.\n- `expires_at`: Data de expira√ß√£o (ISO 8601) ou null para nunca expirar\n\n**Formatos de IP suportados:**\n- IP exato: `\"192.168.1.100\"`\n- CIDR: `\"10.0.0.0/8\"`, `\"192.168.1.0/24\"`\n- Wildcard: `\"192.168.1.*\"`\n\n‚ö†Ô∏è O token completo s√≥ √© exibido na cria√ß√£o!"
          },
          "response": []
        },
        {
          "name": "Create System Token (No IP Restriction)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.token) {",
                  "        pm.collectionVariables.set('systemToken', response.data.token.token);",
                  "        pm.collectionVariables.set('systemTokenId', response.data.token.id);",
                  "        console.log('System Token salvo: ' + response.data.token.token);",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"N8N Development\",\n  \"description\": \"Token de desenvolvimento sem restri√ß√£o de IP\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/system-tokens",
              "host": ["{{baseUrl}}"],
              "path": ["api", "system-tokens"]
            },
            "description": "Cria um token sem restri√ß√£o de IP (√∫til para desenvolvimento). N√£o recomendado para produ√ß√£o!"
          },
          "response": []
        },
        {
          "name": "List System Tokens",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/system-tokens",
              "host": ["{{baseUrl}}"],
              "path": ["api", "system-tokens"]
            },
            "description": "Lista todos os tokens de sistema. Requer permiss√£o de ADMIN.\n\nRetorna informa√ß√µes sobre os tokens, mas N√ÉO retorna o valor do token (por seguran√ßa)."
          },
          "response": []
        },
        {
          "name": "Get System Token by ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/system-tokens/{{systemTokenId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "system-tokens", "{{systemTokenId}}"]
            },
            "description": "Busca informa√ß√µes de um token espec√≠fico. Requer permiss√£o de ADMIN.\n\nN√ÉO retorna o valor do token por seguran√ßa."
          },
          "response": []
        },
        {
          "name": "Update Allowed IPs",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"allowed_ips\": [\"192.168.1.100\", \"192.168.1.101\", \"10.0.0.0/8\"]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/system-tokens/{{systemTokenId}}/allowed-ips",
              "host": ["{{baseUrl}}"],
              "path": ["api", "system-tokens", "{{systemTokenId}}", "allowed-ips"]
            },
            "description": "Atualiza a lista de IPs permitidos para um token. Requer permiss√£o de ADMIN."
          },
          "response": []
        },
        {
          "name": "Get Token Usage Logs",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/system-tokens/{{systemTokenId}}/logs?limit=100",
              "host": ["{{baseUrl}}"],
              "path": ["api", "system-tokens", "{{systemTokenId}}", "logs"],
              "query": [
                {
                  "key": "limit",
                  "value": "100",
                  "description": "N√∫mero m√°ximo de logs a retornar (padr√£o: 100)"
                }
              ]
            },
            "description": "Retorna os logs de uso de um token espec√≠fico. Requer permiss√£o de ADMIN.\n\n√ötil para auditoria e detec√ß√£o de uso suspeito."
          },
          "response": []
        },
        {
          "name": "Revoke System Token",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/system-tokens/{{systemTokenId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "system-tokens", "{{systemTokenId}}"]
            },
            "description": "Revoga (desativa) um token de sistema. Requer permiss√£o de ADMIN.\n\nO token deixa de funcionar imediatamente."
          },
          "response": []
        }
      ]
    },
    {
      "name": "N8N Integration Examples",
      "item": [
        {
          "name": "Get Agent (Using System Token)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "X-System-API-Key",
                "value": "{{systemToken}}",
                "description": "Token de sistema para autentica√ß√£o"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/agents/{{agentId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "agents", "{{agentId}}"]
            },
            "description": "Exemplo de como o N8N deve acessar a API usando um System Token.\n\nUse o header `X-System-API-Key` ao inv√©s de `Authorization: Bearer`.\n\n**No N8N:**\n1. HTTP Request Node\n2. Authentication: None\n3. Headers:\n   - Name: `X-System-API-Key`\n   - Value: `{{seu-token-aqui}}`"
          },
          "response": []
        },
        {
          "name": "List Agents (Using System Token)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "X-System-API-Key",
                "value": "{{systemToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/agents",
              "host": ["{{baseUrl}}"],
              "path": ["api", "agents"]
            },
            "description": "Lista agentes usando System Token. \n\n‚ö†Ô∏è Este endpoint normalmente requer autentica√ß√£o de usu√°rio, mas com System Token voc√™ tem acesso como sistema."
          },
          "response": []
        },
        {
          "name": "Get Agent Plugins (Using System Token)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "X-System-API-Key",
                "value": "{{systemToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/agents/{{agentId}}/plugins",
              "host": ["{{baseUrl}}"],
              "path": ["api", "agents", "{{agentId}}", "plugins"]
            },
            "description": "Lista plugins de um agente usando System Token."
          },
          "response": []
        },
        {
          "name": "Get Conversation (Using System Token)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "X-System-API-Key",
                "value": "{{systemToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/chat/conversations/{{conversationId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "chat", "conversations", "{{conversationId}}"]
            },
            "description": "Busca uma conversa usando System Token."
          },
          "response": []
        },
        {
          "name": "N8N Setup Instructions",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/health",
              "host": ["{{baseUrl}}"],
              "path": ["api", "health"]
            },
            "description": "# Como Configurar N8N com System Tokens\n\n## 1. Criar o Token\n\n### Via Script (Recomendado)\n```bash\ncd back\nnpm run setup:n8n-token\n```\n\n### Ou via API\nUse a requisi√ß√£o \"Create System Token\" desta cole√ß√£o.\n\n## 2. Copiar o Token\n\nO token ser√° exibido no formato:\n```\nsat_abc123def456...\n```\n\n‚ö†Ô∏è **IMPORTANTE:** Guarde este token em local seguro! Ele n√£o ser√° exibido novamente.\n\n## 3. Configurar no N8N\n\n### M√©todo 1: Vari√°vel de Ambiente (Recomendado)\n\n1. No N8N, v√° em **Settings ‚Üí Environment Variables**\n2. Adicione uma nova vari√°vel:\n   - Name: `BACKEND_API_TOKEN`\n   - Value: `sat_abc123...` (seu token)\n\n3. No HTTP Request Node:\n   - URL: `http://localhost:3000/api/agents/123`\n   - Authentication: **None**\n   - Headers:\n     - Name: `X-System-API-Key`\n     - Value: `{{$env.BACKEND_API_TOKEN}}`\n\n### M√©todo 2: Credentials (Alternativo)\n\n1. Crie uma nova Credential do tipo **Header Auth**\n2. Configure:\n   - Name: `X-System-API-Key`\n   - Value: `sat_abc123...` (seu token)\n\n3. No HTTP Request Node:\n   - URL: `http://localhost:3000/api/agents/123`\n   - Authentication: **Header Auth**\n   - Credential: Selecione a credential criada\n\n## 4. Endpoints Dispon√≠veis\n\nCom o System Token, voc√™ pode acessar:\n\n- ‚úÖ `GET /api/agents` - Listar agentes\n- ‚úÖ `GET /api/agents/:id` - Buscar agente\n- ‚úÖ `GET /api/agents/:id/plugins` - Listar plugins do agente\n- ‚úÖ `GET /api/chat/conversations/:id` - Buscar conversa\n- ‚úÖ `GET /api/agents/:id/conversations` - Listar conversas do agente\n\n## 5. Seguran√ßa\n\n### Restri√ß√£o por IP (Produ√ß√£o)\n\nPara maior seguran√ßa, restrinja o token ao IP do servidor N8N:\n\n```bash\n# Descobrir IP do servidor N8N\ncurl https://api.ipify.org\n\n# Criar token com restri√ß√£o\nN8N_ALLOWED_IPS=\"192.168.1.100\" npm run setup:n8n-token\n```\n\nOu atualize via API usando a requisi√ß√£o \"Update Allowed IPs\".\n\n### Formatos de IP Suportados\n\n- **IP exato:** `192.168.1.100`\n- **CIDR:** `10.0.0.0/8`, `192.168.1.0/24`\n- **Wildcard:** `192.168.1.*`\n- **M√∫ltiplos:** `[\"192.168.1.100\", \"10.0.0.0/8\"]`\n\n## 6. Monitoramento\n\n### Ver logs de uso\n\nUse a requisi√ß√£o \"Get Token Usage Logs\" para ver:\n- Todos os acessos\n- IPs de origem\n- Endpoints acessados\n- Timestamps\n\n### Revogar token\n\nSe necess√°rio, use \"Revoke System Token\" para desativar imediatamente.\n\n## 7. Troubleshooting\n\n### \"API Key inv√°lida\"\n- Verifique se o token est√° correto\n- Verifique se o token n√£o foi revogado\n- Liste tokens ativos: \"List System Tokens\"\n\n### \"Unauthorized IP\"\n- IP do N8N n√£o est√° na lista permitida\n- Atualize os IPs: \"Update Allowed IPs\"\n\n### Token n√£o funciona\n- Verifique se est√° usando o header correto: `X-System-API-Key`\n- Verifique se o backend est√° rodando: `GET /api/health`\n\n## Documenta√ß√£o Completa\n\nVer arquivos:\n- `back/README_SYSTEM_TOKENS.md` - Guia r√°pido\n- `back/SYSTEM_TOKENS.md` - Documenta√ß√£o completa\n- `back/ARCHITECTURE_SYSTEM_TOKENS.md` - Arquitetura detalhada"
          },
          "response": []
        }
      ]
    },
    {
      "name": "WebSocket Examples",
      "item": [
        {
          "name": "WebSocket Connection Guide",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/health",
              "host": ["{{baseUrl}}"],
              "path": ["api", "health"]
            },
            "description": "# üîå WebSocket Chat - Guia Completo\n\n## Conex√£o\n\n### Via wscat (Terminal)\n```bash\n# Instale wscat globalmente\nnpm install -g wscat\n\n# Conecte ao WebSocket\nwscat -c \"ws://localhost:3000/ws/chat?token=SEU_TOKEN_JWT_AQUI\"\n```\n\n### Via JavaScript (Browser)\n```javascript\nconst token = 'SEU_TOKEN_JWT';\nconst ws = new WebSocket(`ws://localhost:3000/ws/chat?token=${token}`);\n\nws.onopen = () => {\n  console.log('‚úÖ Conectado');\n};\n\nws.onmessage = (event) => {\n  const data = JSON.parse(event.data);\n  console.log('üì© Recebido:', data);\n  \n  // Salvar socketId quando conectar\n  if (data.type === 'connected') {\n    console.log('üÜî SocketId:', data.data.socketId);\n    window.socketId = data.data.socketId;\n  }\n};\n\nws.onerror = (error) => {\n  console.error('‚ùå Erro:', error);\n};\n\nws.onclose = () => {\n  console.log('üîå Desconectado');\n};\n```\n\n## Mensagens Enviadas (Cliente ‚Üí Servidor)\n\n### 1. Join - Entrar em conversa\n```json\n{\n  \"type\": \"join\",\n  \"data\": {\n    \"agentId\": \"uuid-do-agente\",\n    \"conversationId\": \"uuid-da-conversa\"\n  }\n}\n```\n\n### 2. Message - Enviar mensagem (nova conversa)\n```json\n{\n  \"type\": \"message\",\n  \"data\": {\n    \"agentId\": \"uuid-do-agente\",\n    \"content\": \"Ol√°, preciso de ajuda!\"\n  }\n}\n```\n\n### 3. Message - Continuar conversa\n```json\n{\n  \"type\": \"message\",\n  \"data\": {\n    \"agentId\": \"uuid-do-agente\",\n    \"conversationId\": \"uuid-da-conversa\",\n    \"content\": \"Mais uma pergunta...\"\n  }\n}\n```\n\n### 4. Typing - Indicador de digita√ß√£o\n```json\n{\n  \"type\": \"typing\",\n  \"data\": {}\n}\n```\n\n## Eventos Recebidos (Servidor ‚Üí Cliente)\n\n### 1. Connected - Confirma√ß√£o de conex√£o\n```json\n{\n  \"type\": \"connected\",\n  \"data\": {\n    \"message\": \"Conectado ao chat\",\n    \"socketId\": \"abc-123-def-456\"\n  }\n}\n```\n**‚ö†Ô∏è IMPORTANTE:** Salve o `socketId` para usar em requisi√ß√µes POST!\n\n### 2. Joined - Confirma√ß√£o de join\n```json\n{\n  \"type\": \"joined\",\n  \"data\": {\n    \"agentId\": \"uuid\",\n    \"conversationId\": \"uuid\"\n  }\n}\n```\n\n### 3. Queued - Mensagem enfileirada\n```json\n{\n  \"type\": \"queued\",\n  \"data\": {\n    \"message\": \"Mensagem recebida, processando...\"\n  }\n}\n```\n\n### 4. Processing - Mensagem sendo processada\n```json\n{\n  \"type\": \"processing\",\n  \"data\": {\n    \"conversationId\": \"uuid\",\n    \"messageId\": \"msg-uuid\",\n    \"jobId\": \"job-uuid\",\n    \"status\": \"processing\",\n    \"message\": \"Sua mensagem est√° sendo processada...\"\n  }\n}\n```\n\n### 5. Message - Resposta do agente\n```json\n{\n  \"type\": \"message\",\n  \"data\": {\n    \"messageId\": \"msg-uuid\",\n    \"conversationId\": \"conv-uuid\",\n    \"message\": \"Ol√°! Como posso ajudar?\",\n    \"timestamp\": \"2026-02-02T10:30:00.000Z\",\n    \"metadata\": {\n      \"model\": \"gpt-4\",\n      \"tokensUsed\": 234,\n      \"processingTime\": 3456,\n      \"finishReason\": \"stop\"\n    }\n  }\n}\n```\n\n### 6. Error - Erro\n```json\n{\n  \"type\": \"error\",\n  \"data\": {\n    \"error\": \"Mensagem de erro\"\n  }\n}\n```\n\n## Fluxos Comuns\n\n### Fluxo 1: Nova conversa via WebSocket\n```\n1. Cliente: connect\n2. Servidor: {type: \"connected\", data: {socketId: \"abc\"}}\n3. Cliente: {type: \"message\", data: {agentId, content}}\n4. Servidor: {type: \"queued\"}\n5. Servidor: {type: \"processing\", data: {conversationId, messageId}}\n6. Servidor: {type: \"message\", data: {message: \"resposta\"}}\n```\n\n### Fluxo 2: H√≠brido (POST + WebSocket)\n```\n1. Cliente: connect via WebSocket\n2. Servidor: {type: \"connected\", data: {socketId: \"abc\"}}\n3. Cliente: join conversa {type: \"join\", data: {conversationId}}\n4. Cliente: POST /api/messages (mesmo conversationId)\n5. Servidor: Resposta chega via WebSocket ‚úÖ (broadcast)\n```\n\n### Fluxo 3: M√∫ltiplos dispositivos\n```\n1. Desktop: connect ‚Üí join conversationId \"conv-123\"\n2. Mobile: connect ‚Üí join conversationId \"conv-123\"\n3. Servi√ßo externo: POST /api/messages (conversationId \"conv-123\")\n4. Ambos recebem via WebSocket! üì±üíª\n```\n\n## Heartbeat\n\n```javascript\n// Cliente deve enviar ping a cada 30s\nsetInterval(() => {\n  ws.send(JSON.stringify({ type: 'ping' }));\n}, 30000);\n```\n\nServidor envia `pong` automaticamente.\n\n## Documenta√ß√£o Completa\n\nVer: `back/WEBSOCKET_GUIDE.md`"
          },
          "response": []
        }
      ]
    }
  ],
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{token}}",
        "type": "string"
      }
    ]
  },
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          ""
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          ""
        ]
      }
    }
  ]
}
